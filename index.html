<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Crypto-données</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #0d1b2a; /* bleu sombre */
      color: #ffffff;
    }
    .container {
      display: flex;
      justify-content: space-between;
      max-width: 900px;
      margin: auto;
    }
    .chart-box {
      width: 45%;
      text-align: center;
    }
    .chart-title {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 18px;
      color: #ffffff;
    }
    iframe {
      border: none;
      width: 100%;
      height: 300px;
    }
    h1 {
      text-align: center;
      color: #ffffff;
    }
  </style>
</head>
<body>
  <h1>Crypto-données</h1>
  <div class="container">
    <div class="chart-box">
      <div class="chart-title">BTCUSD</div>
      <iframe src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=60&theme=dark&style=1&locale=fr"
        scrolling="no"></iframe>
    </div>
    <div class="chart-box">
      <div class="chart-title">ETHUSD</div>
      <iframe src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:ETHUSDT&interval=60&theme=dark&style=1&locale=fr"
        scrolling="no"></iframe>
    </div>
  </div>
</body>
</html>




from flask import Flask, request, jsonify
import requests

app = Flask(__name__)

def get_spot_price(asset):
    instrument = f"{asset}-PERPETUAL"
    url = f"https://www.deribit.com/api/v2/public/ticker?instrument_name={instrument}"
    response = requests.get(url).json()
    if 'result' not in response:
        raise ValueError(f"Impossible de récupérer le prix spot pour {asset}.")
    return response['result']['last_price']

def get_options(asset):
    url = f"https://www.deribit.com/api/v2/public/get_instruments?currency={asset}&kind=option&expired=false"
    response = requests.get(url).json()
    return response['result']

def categorize_options(options, spot_price, atm_threshold=0.01):
    count_atm = count_itm = count_otm = 0
    for opt in options:
        strike = opt['strike']
        option_type = opt['option_type']
        if abs(strike - spot_price) / spot_price <= atm_threshold:
            count_atm += 1
        else:
            if option_type == 'call':
                count_itm += 1 if strike < spot_price else count_otm += 1
            elif option_type == 'put':
                count_itm += 1 if strike > spot_price else count_otm += 1
    total = len(options)
    if total == 0:
        return 0, 0, 0
    return (count_atm / total) * 100, (count_itm / total) * 100, (count_otm / total) * 100

@app.route('/api/options')
def api_options():
    asset = request.args.get('asset', 'ETH').upper()
    if asset not in ['ETH', 'BTC']:
        return jsonify({"error": "Actif non pris en charge"}), 400
    try:
        spot = get_spot_price(asset)
        options = get_options(asset)
        atm, itm, otm = categorize_options(options, spot)
        return jsonify({
            "asset": asset,
            "spot_price": round(spot, 2),
            "atm_pct": round(atm, 2),
            "itm_pct": round(itm, 2),
            "otm_pct": round(otm, 2),
        })
    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == "__main__":
    app.run(debug=True)
   
<div style="max-width: 800px; margin: auto; color: #fff; font-size: 18px; text-align: center;">
  <h2>Niveau de l'option</h2>
  <label for="asset">Quel actif veux-tu analyser ?</label>
  <select id="asset" onchange="fetchOptionsData()">
    <option value="ETH">ETH</option>
    <option value="BTC">BTC</option>
  </select>

  <div id="options-data" style="margin-top: 20px;">
    Chargement des données...
  </div>
</div>

<script>
  async function fetchOptionsData() {
    const asset = document.getElementById("asset").value;
    const container = document.getElementById("options-data");
    container.innerHTML = "Chargement des données...";

    try {
      const res = await fetch(`http://localhost:5000/api/options?asset=${asset}`);
      const data = await res.json();

      if (data.error) {
        container.innerHTML = `Erreur : ${data.error}`;
        return;
      }

      container.innerHTML = `
        <strong>${data.asset} Options</strong><br>
        Prix Spot : $${data.spot_price}<br><br>
        <span style="color: #00e676;">ATM : ${data.atm_pct}%</span> &nbsp;&nbsp;
        <span style="color: #2979ff;">ITM : ${data.itm_pct}%</span> &nbsp;&nbsp;
        <span style="color: #ff1744;">OTM : ${data.otm_pct}%</span>
      `;
    } catch (e) {
      container.innerHTML = "Erreur lors du chargement des données.";
      console.error(e);
    }
  }

  // Chargement initial avec ETH
  fetchOptionsData();
</script>



